
<!doctype html>
<html lang="en">

<head>
    <title>Code coverage report for backend/src/services/ai-chat.service.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../prettify.css" />
    <link rel="stylesheet" href="../../../base.css" />
    <link rel="shortcut icon" type="image/x-icon" href="../../../favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../sort-arrow-sprite.png);
        }
    </style>
</head>
    
<body>
<div class='wrapper'>
    <div class='pad1'>
        <h1><a href="../../../index.html">All files</a> / <a href="index.html">backend/src/services</a> ai-chat.service.js</h1>
        <div class='clearfix'>
            
            <div class='fl pad1y space-right2'>
                <span class="strong">9.48% </span>
                <span class="quiet">Statements</span>
                <span class='fraction'>13/137</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">8.65% </span>
                <span class="quiet">Branches</span>
                <span class='fraction'>9/104</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">5.26% </span>
                <span class="quiet">Functions</span>
                <span class='fraction'>1/19</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">10.31% </span>
                <span class="quiet">Lines</span>
                <span class='fraction'>13/126</span>
            </div>
        
            
        </div>
        <p class="quiet">
            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
        </p>
        <template id="filterTemplate">
            <div class="quiet">
                Filter:
                <input type="search" id="fileSearch">
            </div>
        </template>
    </div>
    <div class='status-line low'></div>
    <pre><table class="coverage">
<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
<a name='L2'></a><a href='#L2'>2</a>
<a name='L3'></a><a href='#L3'>3</a>
<a name='L4'></a><a href='#L4'>4</a>
<a name='L5'></a><a href='#L5'>5</a>
<a name='L6'></a><a href='#L6'>6</a>
<a name='L7'></a><a href='#L7'>7</a>
<a name='L8'></a><a href='#L8'>8</a>
<a name='L9'></a><a href='#L9'>9</a>
<a name='L10'></a><a href='#L10'>10</a>
<a name='L11'></a><a href='#L11'>11</a>
<a name='L12'></a><a href='#L12'>12</a>
<a name='L13'></a><a href='#L13'>13</a>
<a name='L14'></a><a href='#L14'>14</a>
<a name='L15'></a><a href='#L15'>15</a>
<a name='L16'></a><a href='#L16'>16</a>
<a name='L17'></a><a href='#L17'>17</a>
<a name='L18'></a><a href='#L18'>18</a>
<a name='L19'></a><a href='#L19'>19</a>
<a name='L20'></a><a href='#L20'>20</a>
<a name='L21'></a><a href='#L21'>21</a>
<a name='L22'></a><a href='#L22'>22</a>
<a name='L23'></a><a href='#L23'>23</a>
<a name='L24'></a><a href='#L24'>24</a>
<a name='L25'></a><a href='#L25'>25</a>
<a name='L26'></a><a href='#L26'>26</a>
<a name='L27'></a><a href='#L27'>27</a>
<a name='L28'></a><a href='#L28'>28</a>
<a name='L29'></a><a href='#L29'>29</a>
<a name='L30'></a><a href='#L30'>30</a>
<a name='L31'></a><a href='#L31'>31</a>
<a name='L32'></a><a href='#L32'>32</a>
<a name='L33'></a><a href='#L33'>33</a>
<a name='L34'></a><a href='#L34'>34</a>
<a name='L35'></a><a href='#L35'>35</a>
<a name='L36'></a><a href='#L36'>36</a>
<a name='L37'></a><a href='#L37'>37</a>
<a name='L38'></a><a href='#L38'>38</a>
<a name='L39'></a><a href='#L39'>39</a>
<a name='L40'></a><a href='#L40'>40</a>
<a name='L41'></a><a href='#L41'>41</a>
<a name='L42'></a><a href='#L42'>42</a>
<a name='L43'></a><a href='#L43'>43</a>
<a name='L44'></a><a href='#L44'>44</a>
<a name='L45'></a><a href='#L45'>45</a>
<a name='L46'></a><a href='#L46'>46</a>
<a name='L47'></a><a href='#L47'>47</a>
<a name='L48'></a><a href='#L48'>48</a>
<a name='L49'></a><a href='#L49'>49</a>
<a name='L50'></a><a href='#L50'>50</a>
<a name='L51'></a><a href='#L51'>51</a>
<a name='L52'></a><a href='#L52'>52</a>
<a name='L53'></a><a href='#L53'>53</a>
<a name='L54'></a><a href='#L54'>54</a>
<a name='L55'></a><a href='#L55'>55</a>
<a name='L56'></a><a href='#L56'>56</a>
<a name='L57'></a><a href='#L57'>57</a>
<a name='L58'></a><a href='#L58'>58</a>
<a name='L59'></a><a href='#L59'>59</a>
<a name='L60'></a><a href='#L60'>60</a>
<a name='L61'></a><a href='#L61'>61</a>
<a name='L62'></a><a href='#L62'>62</a>
<a name='L63'></a><a href='#L63'>63</a>
<a name='L64'></a><a href='#L64'>64</a>
<a name='L65'></a><a href='#L65'>65</a>
<a name='L66'></a><a href='#L66'>66</a>
<a name='L67'></a><a href='#L67'>67</a>
<a name='L68'></a><a href='#L68'>68</a>
<a name='L69'></a><a href='#L69'>69</a>
<a name='L70'></a><a href='#L70'>70</a>
<a name='L71'></a><a href='#L71'>71</a>
<a name='L72'></a><a href='#L72'>72</a>
<a name='L73'></a><a href='#L73'>73</a>
<a name='L74'></a><a href='#L74'>74</a>
<a name='L75'></a><a href='#L75'>75</a>
<a name='L76'></a><a href='#L76'>76</a>
<a name='L77'></a><a href='#L77'>77</a>
<a name='L78'></a><a href='#L78'>78</a>
<a name='L79'></a><a href='#L79'>79</a>
<a name='L80'></a><a href='#L80'>80</a>
<a name='L81'></a><a href='#L81'>81</a>
<a name='L82'></a><a href='#L82'>82</a>
<a name='L83'></a><a href='#L83'>83</a>
<a name='L84'></a><a href='#L84'>84</a>
<a name='L85'></a><a href='#L85'>85</a>
<a name='L86'></a><a href='#L86'>86</a>
<a name='L87'></a><a href='#L87'>87</a>
<a name='L88'></a><a href='#L88'>88</a>
<a name='L89'></a><a href='#L89'>89</a>
<a name='L90'></a><a href='#L90'>90</a>
<a name='L91'></a><a href='#L91'>91</a>
<a name='L92'></a><a href='#L92'>92</a>
<a name='L93'></a><a href='#L93'>93</a>
<a name='L94'></a><a href='#L94'>94</a>
<a name='L95'></a><a href='#L95'>95</a>
<a name='L96'></a><a href='#L96'>96</a>
<a name='L97'></a><a href='#L97'>97</a>
<a name='L98'></a><a href='#L98'>98</a>
<a name='L99'></a><a href='#L99'>99</a>
<a name='L100'></a><a href='#L100'>100</a>
<a name='L101'></a><a href='#L101'>101</a>
<a name='L102'></a><a href='#L102'>102</a>
<a name='L103'></a><a href='#L103'>103</a>
<a name='L104'></a><a href='#L104'>104</a>
<a name='L105'></a><a href='#L105'>105</a>
<a name='L106'></a><a href='#L106'>106</a>
<a name='L107'></a><a href='#L107'>107</a>
<a name='L108'></a><a href='#L108'>108</a>
<a name='L109'></a><a href='#L109'>109</a>
<a name='L110'></a><a href='#L110'>110</a>
<a name='L111'></a><a href='#L111'>111</a>
<a name='L112'></a><a href='#L112'>112</a>
<a name='L113'></a><a href='#L113'>113</a>
<a name='L114'></a><a href='#L114'>114</a>
<a name='L115'></a><a href='#L115'>115</a>
<a name='L116'></a><a href='#L116'>116</a>
<a name='L117'></a><a href='#L117'>117</a>
<a name='L118'></a><a href='#L118'>118</a>
<a name='L119'></a><a href='#L119'>119</a>
<a name='L120'></a><a href='#L120'>120</a>
<a name='L121'></a><a href='#L121'>121</a>
<a name='L122'></a><a href='#L122'>122</a>
<a name='L123'></a><a href='#L123'>123</a>
<a name='L124'></a><a href='#L124'>124</a>
<a name='L125'></a><a href='#L125'>125</a>
<a name='L126'></a><a href='#L126'>126</a>
<a name='L127'></a><a href='#L127'>127</a>
<a name='L128'></a><a href='#L128'>128</a>
<a name='L129'></a><a href='#L129'>129</a>
<a name='L130'></a><a href='#L130'>130</a>
<a name='L131'></a><a href='#L131'>131</a>
<a name='L132'></a><a href='#L132'>132</a>
<a name='L133'></a><a href='#L133'>133</a>
<a name='L134'></a><a href='#L134'>134</a>
<a name='L135'></a><a href='#L135'>135</a>
<a name='L136'></a><a href='#L136'>136</a>
<a name='L137'></a><a href='#L137'>137</a>
<a name='L138'></a><a href='#L138'>138</a>
<a name='L139'></a><a href='#L139'>139</a>
<a name='L140'></a><a href='#L140'>140</a>
<a name='L141'></a><a href='#L141'>141</a>
<a name='L142'></a><a href='#L142'>142</a>
<a name='L143'></a><a href='#L143'>143</a>
<a name='L144'></a><a href='#L144'>144</a>
<a name='L145'></a><a href='#L145'>145</a>
<a name='L146'></a><a href='#L146'>146</a>
<a name='L147'></a><a href='#L147'>147</a>
<a name='L148'></a><a href='#L148'>148</a>
<a name='L149'></a><a href='#L149'>149</a>
<a name='L150'></a><a href='#L150'>150</a>
<a name='L151'></a><a href='#L151'>151</a>
<a name='L152'></a><a href='#L152'>152</a>
<a name='L153'></a><a href='#L153'>153</a>
<a name='L154'></a><a href='#L154'>154</a>
<a name='L155'></a><a href='#L155'>155</a>
<a name='L156'></a><a href='#L156'>156</a>
<a name='L157'></a><a href='#L157'>157</a>
<a name='L158'></a><a href='#L158'>158</a>
<a name='L159'></a><a href='#L159'>159</a>
<a name='L160'></a><a href='#L160'>160</a>
<a name='L161'></a><a href='#L161'>161</a>
<a name='L162'></a><a href='#L162'>162</a>
<a name='L163'></a><a href='#L163'>163</a>
<a name='L164'></a><a href='#L164'>164</a>
<a name='L165'></a><a href='#L165'>165</a>
<a name='L166'></a><a href='#L166'>166</a>
<a name='L167'></a><a href='#L167'>167</a>
<a name='L168'></a><a href='#L168'>168</a>
<a name='L169'></a><a href='#L169'>169</a>
<a name='L170'></a><a href='#L170'>170</a>
<a name='L171'></a><a href='#L171'>171</a>
<a name='L172'></a><a href='#L172'>172</a>
<a name='L173'></a><a href='#L173'>173</a>
<a name='L174'></a><a href='#L174'>174</a>
<a name='L175'></a><a href='#L175'>175</a>
<a name='L176'></a><a href='#L176'>176</a>
<a name='L177'></a><a href='#L177'>177</a>
<a name='L178'></a><a href='#L178'>178</a>
<a name='L179'></a><a href='#L179'>179</a>
<a name='L180'></a><a href='#L180'>180</a>
<a name='L181'></a><a href='#L181'>181</a>
<a name='L182'></a><a href='#L182'>182</a>
<a name='L183'></a><a href='#L183'>183</a>
<a name='L184'></a><a href='#L184'>184</a>
<a name='L185'></a><a href='#L185'>185</a>
<a name='L186'></a><a href='#L186'>186</a>
<a name='L187'></a><a href='#L187'>187</a>
<a name='L188'></a><a href='#L188'>188</a>
<a name='L189'></a><a href='#L189'>189</a>
<a name='L190'></a><a href='#L190'>190</a>
<a name='L191'></a><a href='#L191'>191</a>
<a name='L192'></a><a href='#L192'>192</a>
<a name='L193'></a><a href='#L193'>193</a>
<a name='L194'></a><a href='#L194'>194</a>
<a name='L195'></a><a href='#L195'>195</a>
<a name='L196'></a><a href='#L196'>196</a>
<a name='L197'></a><a href='#L197'>197</a>
<a name='L198'></a><a href='#L198'>198</a>
<a name='L199'></a><a href='#L199'>199</a>
<a name='L200'></a><a href='#L200'>200</a>
<a name='L201'></a><a href='#L201'>201</a>
<a name='L202'></a><a href='#L202'>202</a>
<a name='L203'></a><a href='#L203'>203</a>
<a name='L204'></a><a href='#L204'>204</a>
<a name='L205'></a><a href='#L205'>205</a>
<a name='L206'></a><a href='#L206'>206</a>
<a name='L207'></a><a href='#L207'>207</a>
<a name='L208'></a><a href='#L208'>208</a>
<a name='L209'></a><a href='#L209'>209</a>
<a name='L210'></a><a href='#L210'>210</a>
<a name='L211'></a><a href='#L211'>211</a>
<a name='L212'></a><a href='#L212'>212</a>
<a name='L213'></a><a href='#L213'>213</a>
<a name='L214'></a><a href='#L214'>214</a>
<a name='L215'></a><a href='#L215'>215</a>
<a name='L216'></a><a href='#L216'>216</a>
<a name='L217'></a><a href='#L217'>217</a>
<a name='L218'></a><a href='#L218'>218</a>
<a name='L219'></a><a href='#L219'>219</a>
<a name='L220'></a><a href='#L220'>220</a>
<a name='L221'></a><a href='#L221'>221</a>
<a name='L222'></a><a href='#L222'>222</a>
<a name='L223'></a><a href='#L223'>223</a>
<a name='L224'></a><a href='#L224'>224</a>
<a name='L225'></a><a href='#L225'>225</a>
<a name='L226'></a><a href='#L226'>226</a>
<a name='L227'></a><a href='#L227'>227</a>
<a name='L228'></a><a href='#L228'>228</a>
<a name='L229'></a><a href='#L229'>229</a>
<a name='L230'></a><a href='#L230'>230</a>
<a name='L231'></a><a href='#L231'>231</a>
<a name='L232'></a><a href='#L232'>232</a>
<a name='L233'></a><a href='#L233'>233</a>
<a name='L234'></a><a href='#L234'>234</a>
<a name='L235'></a><a href='#L235'>235</a>
<a name='L236'></a><a href='#L236'>236</a>
<a name='L237'></a><a href='#L237'>237</a>
<a name='L238'></a><a href='#L238'>238</a>
<a name='L239'></a><a href='#L239'>239</a>
<a name='L240'></a><a href='#L240'>240</a>
<a name='L241'></a><a href='#L241'>241</a>
<a name='L242'></a><a href='#L242'>242</a>
<a name='L243'></a><a href='#L243'>243</a>
<a name='L244'></a><a href='#L244'>244</a>
<a name='L245'></a><a href='#L245'>245</a>
<a name='L246'></a><a href='#L246'>246</a>
<a name='L247'></a><a href='#L247'>247</a>
<a name='L248'></a><a href='#L248'>248</a>
<a name='L249'></a><a href='#L249'>249</a>
<a name='L250'></a><a href='#L250'>250</a>
<a name='L251'></a><a href='#L251'>251</a>
<a name='L252'></a><a href='#L252'>252</a>
<a name='L253'></a><a href='#L253'>253</a>
<a name='L254'></a><a href='#L254'>254</a>
<a name='L255'></a><a href='#L255'>255</a>
<a name='L256'></a><a href='#L256'>256</a>
<a name='L257'></a><a href='#L257'>257</a>
<a name='L258'></a><a href='#L258'>258</a>
<a name='L259'></a><a href='#L259'>259</a>
<a name='L260'></a><a href='#L260'>260</a>
<a name='L261'></a><a href='#L261'>261</a>
<a name='L262'></a><a href='#L262'>262</a>
<a name='L263'></a><a href='#L263'>263</a>
<a name='L264'></a><a href='#L264'>264</a>
<a name='L265'></a><a href='#L265'>265</a>
<a name='L266'></a><a href='#L266'>266</a>
<a name='L267'></a><a href='#L267'>267</a>
<a name='L268'></a><a href='#L268'>268</a>
<a name='L269'></a><a href='#L269'>269</a>
<a name='L270'></a><a href='#L270'>270</a>
<a name='L271'></a><a href='#L271'>271</a>
<a name='L272'></a><a href='#L272'>272</a>
<a name='L273'></a><a href='#L273'>273</a>
<a name='L274'></a><a href='#L274'>274</a>
<a name='L275'></a><a href='#L275'>275</a>
<a name='L276'></a><a href='#L276'>276</a>
<a name='L277'></a><a href='#L277'>277</a>
<a name='L278'></a><a href='#L278'>278</a>
<a name='L279'></a><a href='#L279'>279</a>
<a name='L280'></a><a href='#L280'>280</a>
<a name='L281'></a><a href='#L281'>281</a>
<a name='L282'></a><a href='#L282'>282</a>
<a name='L283'></a><a href='#L283'>283</a>
<a name='L284'></a><a href='#L284'>284</a>
<a name='L285'></a><a href='#L285'>285</a>
<a name='L286'></a><a href='#L286'>286</a>
<a name='L287'></a><a href='#L287'>287</a>
<a name='L288'></a><a href='#L288'>288</a>
<a name='L289'></a><a href='#L289'>289</a>
<a name='L290'></a><a href='#L290'>290</a>
<a name='L291'></a><a href='#L291'>291</a>
<a name='L292'></a><a href='#L292'>292</a>
<a name='L293'></a><a href='#L293'>293</a>
<a name='L294'></a><a href='#L294'>294</a>
<a name='L295'></a><a href='#L295'>295</a>
<a name='L296'></a><a href='#L296'>296</a>
<a name='L297'></a><a href='#L297'>297</a>
<a name='L298'></a><a href='#L298'>298</a>
<a name='L299'></a><a href='#L299'>299</a>
<a name='L300'></a><a href='#L300'>300</a>
<a name='L301'></a><a href='#L301'>301</a>
<a name='L302'></a><a href='#L302'>302</a>
<a name='L303'></a><a href='#L303'>303</a>
<a name='L304'></a><a href='#L304'>304</a>
<a name='L305'></a><a href='#L305'>305</a>
<a name='L306'></a><a href='#L306'>306</a>
<a name='L307'></a><a href='#L307'>307</a>
<a name='L308'></a><a href='#L308'>308</a>
<a name='L309'></a><a href='#L309'>309</a>
<a name='L310'></a><a href='#L310'>310</a>
<a name='L311'></a><a href='#L311'>311</a>
<a name='L312'></a><a href='#L312'>312</a>
<a name='L313'></a><a href='#L313'>313</a>
<a name='L314'></a><a href='#L314'>314</a>
<a name='L315'></a><a href='#L315'>315</a>
<a name='L316'></a><a href='#L316'>316</a>
<a name='L317'></a><a href='#L317'>317</a>
<a name='L318'></a><a href='#L318'>318</a>
<a name='L319'></a><a href='#L319'>319</a>
<a name='L320'></a><a href='#L320'>320</a>
<a name='L321'></a><a href='#L321'>321</a>
<a name='L322'></a><a href='#L322'>322</a>
<a name='L323'></a><a href='#L323'>323</a>
<a name='L324'></a><a href='#L324'>324</a>
<a name='L325'></a><a href='#L325'>325</a>
<a name='L326'></a><a href='#L326'>326</a>
<a name='L327'></a><a href='#L327'>327</a>
<a name='L328'></a><a href='#L328'>328</a>
<a name='L329'></a><a href='#L329'>329</a>
<a name='L330'></a><a href='#L330'>330</a>
<a name='L331'></a><a href='#L331'>331</a>
<a name='L332'></a><a href='#L332'>332</a>
<a name='L333'></a><a href='#L333'>333</a>
<a name='L334'></a><a href='#L334'>334</a>
<a name='L335'></a><a href='#L335'>335</a>
<a name='L336'></a><a href='#L336'>336</a>
<a name='L337'></a><a href='#L337'>337</a>
<a name='L338'></a><a href='#L338'>338</a>
<a name='L339'></a><a href='#L339'>339</a>
<a name='L340'></a><a href='#L340'>340</a>
<a name='L341'></a><a href='#L341'>341</a>
<a name='L342'></a><a href='#L342'>342</a>
<a name='L343'></a><a href='#L343'>343</a>
<a name='L344'></a><a href='#L344'>344</a>
<a name='L345'></a><a href='#L345'>345</a>
<a name='L346'></a><a href='#L346'>346</a>
<a name='L347'></a><a href='#L347'>347</a>
<a name='L348'></a><a href='#L348'>348</a>
<a name='L349'></a><a href='#L349'>349</a>
<a name='L350'></a><a href='#L350'>350</a>
<a name='L351'></a><a href='#L351'>351</a>
<a name='L352'></a><a href='#L352'>352</a>
<a name='L353'></a><a href='#L353'>353</a>
<a name='L354'></a><a href='#L354'>354</a>
<a name='L355'></a><a href='#L355'>355</a>
<a name='L356'></a><a href='#L356'>356</a>
<a name='L357'></a><a href='#L357'>357</a>
<a name='L358'></a><a href='#L358'>358</a>
<a name='L359'></a><a href='#L359'>359</a>
<a name='L360'></a><a href='#L360'>360</a>
<a name='L361'></a><a href='#L361'>361</a>
<a name='L362'></a><a href='#L362'>362</a>
<a name='L363'></a><a href='#L363'>363</a>
<a name='L364'></a><a href='#L364'>364</a>
<a name='L365'></a><a href='#L365'>365</a>
<a name='L366'></a><a href='#L366'>366</a>
<a name='L367'></a><a href='#L367'>367</a>
<a name='L368'></a><a href='#L368'>368</a>
<a name='L369'></a><a href='#L369'>369</a>
<a name='L370'></a><a href='#L370'>370</a>
<a name='L371'></a><a href='#L371'>371</a>
<a name='L372'></a><a href='#L372'>372</a>
<a name='L373'></a><a href='#L373'>373</a>
<a name='L374'></a><a href='#L374'>374</a>
<a name='L375'></a><a href='#L375'>375</a>
<a name='L376'></a><a href='#L376'>376</a>
<a name='L377'></a><a href='#L377'>377</a>
<a name='L378'></a><a href='#L378'>378</a>
<a name='L379'></a><a href='#L379'>379</a>
<a name='L380'></a><a href='#L380'>380</a>
<a name='L381'></a><a href='#L381'>381</a>
<a name='L382'></a><a href='#L382'>382</a>
<a name='L383'></a><a href='#L383'>383</a>
<a name='L384'></a><a href='#L384'>384</a>
<a name='L385'></a><a href='#L385'>385</a>
<a name='L386'></a><a href='#L386'>386</a>
<a name='L387'></a><a href='#L387'>387</a>
<a name='L388'></a><a href='#L388'>388</a>
<a name='L389'></a><a href='#L389'>389</a>
<a name='L390'></a><a href='#L390'>390</a>
<a name='L391'></a><a href='#L391'>391</a>
<a name='L392'></a><a href='#L392'>392</a>
<a name='L393'></a><a href='#L393'>393</a>
<a name='L394'></a><a href='#L394'>394</a>
<a name='L395'></a><a href='#L395'>395</a>
<a name='L396'></a><a href='#L396'>396</a>
<a name='L397'></a><a href='#L397'>397</a>
<a name='L398'></a><a href='#L398'>398</a>
<a name='L399'></a><a href='#L399'>399</a>
<a name='L400'></a><a href='#L400'>400</a>
<a name='L401'></a><a href='#L401'>401</a>
<a name='L402'></a><a href='#L402'>402</a>
<a name='L403'></a><a href='#L403'>403</a>
<a name='L404'></a><a href='#L404'>404</a>
<a name='L405'></a><a href='#L405'>405</a>
<a name='L406'></a><a href='#L406'>406</a>
<a name='L407'></a><a href='#L407'>407</a>
<a name='L408'></a><a href='#L408'>408</a>
<a name='L409'></a><a href='#L409'>409</a>
<a name='L410'></a><a href='#L410'>410</a>
<a name='L411'></a><a href='#L411'>411</a>
<a name='L412'></a><a href='#L412'>412</a>
<a name='L413'></a><a href='#L413'>413</a>
<a name='L414'></a><a href='#L414'>414</a>
<a name='L415'></a><a href='#L415'>415</a>
<a name='L416'></a><a href='#L416'>416</a>
<a name='L417'></a><a href='#L417'>417</a>
<a name='L418'></a><a href='#L418'>418</a>
<a name='L419'></a><a href='#L419'>419</a>
<a name='L420'></a><a href='#L420'>420</a>
<a name='L421'></a><a href='#L421'>421</a>
<a name='L422'></a><a href='#L422'>422</a>
<a name='L423'></a><a href='#L423'>423</a>
<a name='L424'></a><a href='#L424'>424</a>
<a name='L425'></a><a href='#L425'>425</a>
<a name='L426'></a><a href='#L426'>426</a>
<a name='L427'></a><a href='#L427'>427</a>
<a name='L428'></a><a href='#L428'>428</a>
<a name='L429'></a><a href='#L429'>429</a>
<a name='L430'></a><a href='#L430'>430</a>
<a name='L431'></a><a href='#L431'>431</a>
<a name='L432'></a><a href='#L432'>432</a>
<a name='L433'></a><a href='#L433'>433</a>
<a name='L434'></a><a href='#L434'>434</a>
<a name='L435'></a><a href='#L435'>435</a>
<a name='L436'></a><a href='#L436'>436</a>
<a name='L437'></a><a href='#L437'>437</a>
<a name='L438'></a><a href='#L438'>438</a>
<a name='L439'></a><a href='#L439'>439</a>
<a name='L440'></a><a href='#L440'>440</a>
<a name='L441'></a><a href='#L441'>441</a>
<a name='L442'></a><a href='#L442'>442</a>
<a name='L443'></a><a href='#L443'>443</a>
<a name='L444'></a><a href='#L444'>444</a>
<a name='L445'></a><a href='#L445'>445</a>
<a name='L446'></a><a href='#L446'>446</a>
<a name='L447'></a><a href='#L447'>447</a>
<a name='L448'></a><a href='#L448'>448</a>
<a name='L449'></a><a href='#L449'>449</a>
<a name='L450'></a><a href='#L450'>450</a>
<a name='L451'></a><a href='#L451'>451</a>
<a name='L452'></a><a href='#L452'>452</a>
<a name='L453'></a><a href='#L453'>453</a>
<a name='L454'></a><a href='#L454'>454</a>
<a name='L455'></a><a href='#L455'>455</a>
<a name='L456'></a><a href='#L456'>456</a>
<a name='L457'></a><a href='#L457'>457</a>
<a name='L458'></a><a href='#L458'>458</a>
<a name='L459'></a><a href='#L459'>459</a>
<a name='L460'></a><a href='#L460'>460</a>
<a name='L461'></a><a href='#L461'>461</a>
<a name='L462'></a><a href='#L462'>462</a>
<a name='L463'></a><a href='#L463'>463</a>
<a name='L464'></a><a href='#L464'>464</a>
<a name='L465'></a><a href='#L465'>465</a>
<a name='L466'></a><a href='#L466'>466</a>
<a name='L467'></a><a href='#L467'>467</a>
<a name='L468'></a><a href='#L468'>468</a>
<a name='L469'></a><a href='#L469'>469</a>
<a name='L470'></a><a href='#L470'>470</a>
<a name='L471'></a><a href='#L471'>471</a>
<a name='L472'></a><a href='#L472'>472</a>
<a name='L473'></a><a href='#L473'>473</a>
<a name='L474'></a><a href='#L474'>474</a>
<a name='L475'></a><a href='#L475'>475</a>
<a name='L476'></a><a href='#L476'>476</a>
<a name='L477'></a><a href='#L477'>477</a>
<a name='L478'></a><a href='#L478'>478</a>
<a name='L479'></a><a href='#L479'>479</a>
<a name='L480'></a><a href='#L480'>480</a>
<a name='L481'></a><a href='#L481'>481</a>
<a name='L482'></a><a href='#L482'>482</a>
<a name='L483'></a><a href='#L483'>483</a>
<a name='L484'></a><a href='#L484'>484</a>
<a name='L485'></a><a href='#L485'>485</a>
<a name='L486'></a><a href='#L486'>486</a>
<a name='L487'></a><a href='#L487'>487</a>
<a name='L488'></a><a href='#L488'>488</a>
<a name='L489'></a><a href='#L489'>489</a>
<a name='L490'></a><a href='#L490'>490</a></td><td class="line-coverage quiet"><span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span></td><td class="text"><pre class="prettyprint lang-js">const { OpenAI } = require('openai');
const Anthropic = require('@anthropic-ai/sdk');
&nbsp;
class AIChatService {
  constructor() {
    // Configuration des APIs
    this.openaiEnabled = !!process.env.OPENAI_API_KEY &amp;&amp; <span class="branch-1 cbranch-no" title="branch not covered" >process.env.OPENAI_API_KEY !== 'your_openai_api_key_here';</span>
    this.claudeEnabled = !!process.env.ANTHROPIC_API_KEY &amp;&amp; <span class="branch-1 cbranch-no" title="branch not covered" >process.env.ANTHROPIC_API_KEY !== 'your_anthropic_api_key_here';</span>
    
    // Initialisation des clients
    <span class="missing-if-branch" title="if path not taken" >I</span>if (this.openaiEnabled) {
<span class="cstat-no" title="statement not covered" >      this.openai = new OpenAI({</span>
        apiKey: process.env.OPENAI_API_KEY
      });
<span class="cstat-no" title="statement not covered" >      console.log('✅ OpenAI client initialisé');</span>
    }
    
    <span class="missing-if-branch" title="if path not taken" >I</span>if (this.claudeEnabled) {
<span class="cstat-no" title="statement not covered" >      this.anthropic = new Anthropic({</span>
        apiKey: process.env.ANTHROPIC_API_KEY
      });
<span class="cstat-no" title="statement not covered" >      console.log('✅ Claude client initialisé');</span>
    }
    
    // Configuration par défaut
    this.defaultProvider = process.env.DEFAULT_AI_PROVIDER || 'openai';
    this.mockMode = !this.openaiEnabled &amp;&amp; !this.claudeEnabled;
    
    <span class="missing-if-branch" title="else path not taken" >E</span>if (this.mockMode) {
      console.warn('⚠️ Mode mock activé - Aucune clé API AI configurée');
      console.warn('🔑 Configurez OPENAI_API_KEY ou ANTHROPIC_API_KEY pour utiliser l\'IA réelle');
    }
    
    // Prompts système pour différents contextes
    this.systemPrompts = {
      health_coach: `Tu es AVA, un coach santé IA expert et bienveillant. Tu aides les utilisateurs à améliorer leur santé et bien-être à travers des conseils personnalisés.
&nbsp;
TON RÔLE:
- Coach santé personnel et motivant
- Expert en nutrition, fitness, sommeil et gestion du stress
- Accompagnateur empathique et encourageant
&nbsp;
DIRECTIVES:
- Réponds toujours en français
- Sois concis mais informatif (max 200 mots sauf demande spécifique)
- Donne des conseils pratiques et actionnables
- Adapte tes réponses au niveau d'abonnement de l'utilisateur
- Ne donne jamais de diagnostic médical
- Encourage à consulter un professionnel si nécessaire
- Utilise les données de santé de l'utilisateur pour personnaliser tes conseils
&nbsp;
STYLE:
- Ton amical et motivant
- Utilise des emojis occasionnellement
- Exemple concret et pratique
- Questions pour engager l'utilisateur`,
&nbsp;
      nutrition: `Tu es un expert en nutrition qui aide les utilisateurs d'AVA à améliorer leur alimentation.
&nbsp;
SPÉCIALISATION:
- Analyse nutritionnelle des repas
- Recommandations alimentaires personnalisées  
- Plans de repas équilibrés
- Gestion des restrictions alimentaires
&nbsp;
Utilise les données Spoonacular disponibles et donne des conseils pratiques et réalisables.`,
&nbsp;
      fitness: `Tu es un coach sportif personnel qui aide les utilisateurs d'AVA à atteindre leurs objectifs fitness.
&nbsp;
SPÉCIALISATION:
- Programmes d'entraînement personnalisés
- Conseils sur la récupération
- Motivation et encouragement
- Adaptation selon les données Garmin
&nbsp;
Crée des programmes progressifs et sécuritaires adaptés au niveau de l'utilisateur.`,
&nbsp;
      wellness: `Tu es un expert en bien-être qui aide les utilisateurs d'AVA à améliorer leur qualité de vie globale.
&nbsp;
SPÉCIALISATION:
- Gestion du stress
- Optimisation du sommeil
- Équilibre vie-travail
- Techniques de relaxation et mindfulness
&nbsp;
Utilise les données de stress et sommeil Garmin pour des conseils personnalisés.`
    };
  }
&nbsp;
  // Générer une réponse de chat
<span class="fstat-no" title="function not covered" >  as</span>ync generateResponse(message, context = <span class="branch-0 cbranch-no" title="branch not covered" >{})</span> {
<span class="cstat-no" title="statement not covered" >    try {</span>
      const {
        userId,
        userProfile,
        healthData,
        chatHistory = <span class="branch-0 cbranch-no" title="branch not covered" >[],</span>
        responseType = <span class="branch-0 cbranch-no" title="branch not covered" >'health_coach',</span>
        subscriptionLevel = <span class="branch-0 cbranch-no" title="branch not covered" >'explore',</span>
        maxTokens = <span class="branch-0 cbranch-no" title="branch not covered" >300</span>
      } = <span class="cstat-no" title="statement not covered" >context;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      console.log(`🤖 Génération de réponse AI pour ${userId || 'utilisateur anonyme'}`);</span>
&nbsp;
      // Utiliser l'IA réelle si disponible
<span class="cstat-no" title="statement not covered" >      if (!this.mockMode) {</span>
<span class="cstat-no" title="statement not covered" >        return await this.generateRealAIResponse(message, context, responseType, maxTokens);</span>
      }
&nbsp;
      // Mode mock avec réponses intelligentes
<span class="cstat-no" title="statement not covered" >      return this.generateMockResponse(message, context, responseType);</span>
&nbsp;
    } catch (error) {
<span class="cstat-no" title="statement not covered" >      console.error('❌ Erreur génération réponse AI:', error);</span>
      
      // Fallback vers réponse mock en cas d'erreur
<span class="cstat-no" title="statement not covered" >      return this.generateMockResponse(message, context);</span>
    }
  }
&nbsp;
  // Générer réponse avec IA réelle
<span class="fstat-no" title="function not covered" >  as</span>ync generateRealAIResponse(message, context, responseType, maxTokens) {
    const systemPrompt = <span class="cstat-no" title="statement not covered" >this.systemPrompts[responseType] || this.systemPrompts.health_coach;</span>
    const provider = <span class="cstat-no" title="statement not covered" >this.selectProvider(context.preferredProvider);</span>
    
    // Construire le contexte personnalisé
    const personalizedContext = <span class="cstat-no" title="statement not covered" >this.buildPersonalizedContext(context);</span>
    const fullPrompt = <span class="cstat-no" title="statement not covered" >`${systemPrompt}\n\n${personalizedContext}\n\nUtilisateur: ${message}`;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (provider === 'claude' &amp;&amp; this.claudeEnabled) {</span>
<span class="cstat-no" title="statement not covered" >      return await this.generateClaudeResponse(fullPrompt, maxTokens);</span>
    } else <span class="cstat-no" title="statement not covered" >if (provider === 'openai' &amp;&amp; this.openaiEnabled) {</span>
<span class="cstat-no" title="statement not covered" >      return await this.generateOpenAIResponse(fullPrompt, maxTokens, context.chatHistory);</span>
    }
&nbsp;
    // Fallback si le provider préféré n'est pas disponible
<span class="cstat-no" title="statement not covered" >    throw new Error('Aucun provider AI disponible');</span>
  }
&nbsp;
  // Générer réponse avec Claude
<span class="fstat-no" title="function not covered" >  as</span>ync generateClaudeResponse(prompt, maxTokens) {
    const response = <span class="cstat-no" title="statement not covered" >await this.anthropic.messages.create({</span>
      model: 'claude-3-sonnet-20240229',
      max_tokens: maxTokens,
      messages: [
        {
          role: 'user',
          content: prompt
        }
      ]
    });
&nbsp;
<span class="cstat-no" title="statement not covered" >    return {</span>
      response: response.content[0].text,
      provider: 'claude',
      model: 'claude-3-sonnet',
      tokens: response.usage?.input_tokens + response.usage?.output_tokens,
      cost: this.calculateCost('claude', response.usage?.input_tokens, response.usage?.output_tokens)
    };
  }
&nbsp;
  // Générer réponse avec OpenAI
<span class="fstat-no" title="function not covered" >  as</span>ync generateOpenAIResponse(prompt, maxTokens, chatHistory = <span class="branch-0 cbranch-no" title="branch not covered" >[])</span> {
    const messages = <span class="cstat-no" title="statement not covered" >[</span>
      { role: 'system', content: prompt }
    ];
&nbsp;
    // Ajouter l'historique de conversation (max 10 derniers messages)
    const recentHistory = <span class="cstat-no" title="statement not covered" >chatHistory.slice(-10);</span>
<span class="cstat-no" title="statement not covered" >    messages.push(...recentHistory);</span>
&nbsp;
    const response = <span class="cstat-no" title="statement not covered" >await this.openai.chat.completions.create({</span>
      model: 'gpt-3.5-turbo',
      messages: messages,
      max_tokens: maxTokens,
      temperature: 0.7,
      presence_penalty: 0.1,
      frequency_penalty: 0.1
    });
&nbsp;
<span class="cstat-no" title="statement not covered" >    return {</span>
      response: response.choices[0].message.content,
      provider: 'openai',
      model: 'gpt-3.5-turbo',
      tokens: response.usage.total_tokens,
      cost: this.calculateCost('openai', response.usage.prompt_tokens, response.usage.completion_tokens)
    };
  }
&nbsp;
  // Générer réponse mock intelligente
<span class="fstat-no" title="function not covered" >  ge</span>nerateMockResponse(message, context, responseType = <span class="branch-0 cbranch-no" title="branch not covered" >'health_coach')</span> {
    const { userProfile, healthData, subscriptionLevel } = <span class="cstat-no" title="statement not covered" >context;</span>
    const userName = <span class="cstat-no" title="statement not covered" >userProfile?.prenom || 'utilisateur';</span>
    
    // Analyser le message pour détecter les intentions
    const intent = <span class="cstat-no" title="statement not covered" >this.detectIntent(message);</span>
    
    const mockResponses = <span class="cstat-no" title="statement not covered" >{</span>
      greeting: [
        `Salut ${userName} ! 👋 Je suis AVA, ton coach santé IA. Comment puis-je t'aider aujourd'hui ?`,
        `Bonjour ${userName} ! Prêt(e) à améliorer ta santé avec moi ? 🌟`,
        `Hello ${userName} ! Que veux-tu savoir sur ta santé et ton bien-être ?`
      ],
      
      health_status: [
        `D'après tes données récentes, tu sembles être sur la bonne voie ! ${this.generateHealthInsight(healthData)} Veux-tu des conseils spécifiques ?`,
        `Tes métriques de santé montrent des tendances intéressantes. ${this.generateHealthInsight(healthData)} Comment te sens-tu ?`,
        `Ton score de santé global est encouraging ! ${this.generateHealthInsight(healthData)}`
      ],
      
      nutrition: [
        `Pour ton objectif nutritionnel, je recommande de te concentrer sur les protéines et les légumes. Veux-tu un plan de repas personnalisé ?`,
        `Une alimentation équilibrée est clé pour tes objectifs. Avec ton abonnement ${subscriptionLevel}, je peux t'aider à optimiser tes repas !`,
        `Tes habitudes alimentaires ont un impact direct sur tes performances. Parlons de nutrition pratique !`
      ],
      
      fitness: [
        `Basé sur ton niveau d'activité, je suggère un programme progressif. Combien de temps peux-tu consacrer à l'exercice par semaine ?`,
        `Tes données d'activité montrent que tu es motivé(e) ! Optimisons ton entraînement ensemble 💪`,
        `Un bon équilibre cardio-musculation serait parfait pour toi. Veux-tu un programme personnalisé ?`
      ],
      
      sleep: [
        `Le sommeil est crucial pour ta récupération. ${this.generateSleepAdvice(healthData)} Veux-tu des conseils pour mieux dormir ?`,
        `Tes données de sommeil suggèrent quelques améliorations possibles. Parlons d'hygiène du sommeil !`,
        `Un sommeil de qualité boostera tes performances. Voici mes conseils pour cette nuit...`
      ],
      
      stress: [
        `La gestion du stress est importante pour ton bien-être. ${this.generateStressAdvice(healthData)} Essayons des techniques de relaxation ?`,
        `Je vois que tu pourrais bénéficier de techniques anti-stress. Veux-tu apprendre quelques exercices de respiration ?`,
        `Gérer le stress améliore tout le reste ! Parlons de techniques pratiques pour ton quotidien.`
      ],
      
      motivation: [
        `Tu es sur la bonne voie, ${userName} ! 🌟 Chaque petit pas compte. Quel est ton objectif principal aujourd'hui ?`,
        `Je crois en toi ! Tes efforts récents montrent ta détermination. Continue comme ça ! 💪`,
        `Rappelle-toi pourquoi tu as commencé. Tu as déjà fait tant de progrès ! Qu'est-ce qui te motive le plus ?`
      ],
      
      default: [
        `Intéressant ! En tant que ton coach santé, je pense que ${this.generateGenericAdvice(message, context)}. Veux-tu qu'on creuse ensemble ?`,
        `C'est une excellente question ! Avec tes données actuelles, je recommande ${this.generateGenericAdvice(message, context)}.`,
        `Laisse-moi t'aider avec ça ! Basé sur ton profil, ${this.generateGenericAdvice(message, context)}. Qu'en penses-tu ?`
      ]
    };
&nbsp;
    const responses = <span class="cstat-no" title="statement not covered" >mockResponses[intent] || mockResponses.default;</span>
    const selectedResponse = <span class="cstat-no" title="statement not covered" >responses[Math.floor(Math.random() * responses.length)];</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    return {</span>
      response: selectedResponse,
      provider: 'mock',
      model: 'ava-mock-v1',
      tokens: selectedResponse.length / 4, // Estimation
      cost: 0,
      confidence: 0.8,
      intent: intent,
      subscription_gated: subscriptionLevel === 'explore' &amp;&amp; intent !== 'greeting'
    };
  }
&nbsp;
  // Détecter l'intention du message
<span class="fstat-no" title="function not covered" >  de</span>tectIntent(message) {
    const lowerMessage = <span class="cstat-no" title="statement not covered" >message.toLowerCase();</span>
    
    const intentKeywords = <span class="cstat-no" title="statement not covered" >{</span>
      greeting: ['bonjour', 'salut', 'hello', 'coucou', 'bonsoir'],
      health_status: ['comment', 'santé', 'forme', 'état', 'va', 'score'],
      nutrition: ['manger', 'repas', 'nutrition', 'aliment', 'régime', 'calories'],
      fitness: ['sport', 'exercice', 'musculation', 'cardio', 'entraînement', 'workout'],
      sleep: ['sommeil', 'dormir', 'fatigue', 'réveil', 'insomnie', 'repos'],
      stress: ['stress', 'anxiété', 'zen', 'relaxation', 'tension', 'calme'],
      motivation: ['motiver', 'encourager', 'objectif', 'but', 'réussir', 'continuer']
    };
&nbsp;
<span class="cstat-no" title="statement not covered" >    for (const [intent, keywords] of Object.entries(intentKeywords)) {</span>
<span class="cstat-no" title="statement not covered" >      if (keywords.some(<span class="fstat-no" title="function not covered" >ke</span>yword =&gt; <span class="cstat-no" title="statement not covered" >lowerMessage.includes(keyword))</span>) {</span>
<span class="cstat-no" title="statement not covered" >        return intent;</span>
      }
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    return 'default';</span>
  }
&nbsp;
  // Construire le contexte personnalisé
<span class="fstat-no" title="function not covered" >  bu</span>ildPersonalizedContext(context) {
    const { userProfile, healthData, subscriptionLevel } = <span class="cstat-no" title="statement not covered" >context;</span>
    
    let contextStr = <span class="cstat-no" title="statement not covered" >`CONTEXTE UTILISATEUR:\n`;</span>
    
<span class="cstat-no" title="statement not covered" >    if (userProfile) {</span>
<span class="cstat-no" title="statement not covered" >      contextStr += `- Profil: ${userProfile.prenom || 'Utilisateur'}\n`;</span>
<span class="cstat-no" title="statement not covered" >      contextStr += `- Abonnement: ${subscriptionLevel}\n`;</span>
<span class="cstat-no" title="statement not covered" >      if (userProfile.preferences?.objectif) {</span>
<span class="cstat-no" title="statement not covered" >        contextStr += `- Objectif: ${userProfile.preferences.objectif}\n`;</span>
      }
    }
    
<span class="cstat-no" title="statement not covered" >    if (healthData) {</span>
<span class="cstat-no" title="statement not covered" >      contextStr += `- Données récentes:\n`;</span>
<span class="cstat-no" title="statement not covered" >      if (healthData.steps) <span class="cstat-no" title="statement not covered" >contextStr += `  * Pas: ${healthData.steps}\n`;</span></span>
<span class="cstat-no" title="statement not covered" >      if (healthData.sleep) <span class="cstat-no" title="statement not covered" >contextStr += `  * Sommeil: ${healthData.sleep}h\n`;</span></span>
<span class="cstat-no" title="statement not covered" >      if (healthData.stress) <span class="cstat-no" title="statement not covered" >contextStr += `  * Stress: ${healthData.stress}/100\n`;</span></span>
<span class="cstat-no" title="statement not covered" >      if (healthData.energy) <span class="cstat-no" title="statement not covered" >contextStr += `  * Énergie: ${healthData.energy}/100\n`;</span></span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    return contextStr;</span>
  }
&nbsp;
  // Tester la connexion aux API AI
<span class="fstat-no" title="function not covered" >  as</span>ync testAPIConnections() {
    const results = <span class="cstat-no" title="statement not covered" >{</span>
      openai: { available: this.openaiEnabled, working: false, error: null },
      claude: { available: this.claudeEnabled, working: false, error: null },
      mockMode: this.mockMode
    };
&nbsp;
    // Test OpenAI
<span class="cstat-no" title="statement not covered" >    if (this.openaiEnabled) {</span>
<span class="cstat-no" title="statement not covered" >      try {</span>
        const testResponse = <span class="cstat-no" title="statement not covered" >await this.openai.chat.completions.create({</span>
          model: 'gpt-3.5-turbo',
          messages: [{ role: 'user', content: 'Test' }],
          max_tokens: 5
        });
<span class="cstat-no" title="statement not covered" >        results.openai.working = true;</span>
<span class="cstat-no" title="statement not covered" >        console.log('✅ OpenAI API fonctionne');</span>
      } catch (error) {
<span class="cstat-no" title="statement not covered" >        results.openai.error = error.message;</span>
<span class="cstat-no" title="statement not covered" >        console.log('❌ OpenAI API erreur:', error.message);</span>
      }
    }
&nbsp;
    // Test Claude
<span class="cstat-no" title="statement not covered" >    if (this.claudeEnabled) {</span>
<span class="cstat-no" title="statement not covered" >      try {</span>
        const testResponse = <span class="cstat-no" title="statement not covered" >await this.anthropic.messages.create({</span>
          model: 'claude-3-sonnet-20240229',
          max_tokens: 5,
          messages: [{ role: 'user', content: 'Test' }]
        });
<span class="cstat-no" title="statement not covered" >        results.claude.working = true;</span>
<span class="cstat-no" title="statement not covered" >        console.log('✅ Claude API fonctionne');</span>
      } catch (error) {
<span class="cstat-no" title="statement not covered" >        results.claude.error = error.message;</span>
<span class="cstat-no" title="statement not covered" >        console.log('❌ Claude API erreur:', error.message);</span>
      }
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    return results;</span>
  }
&nbsp;
  // Obtenir le statut du service
<span class="fstat-no" title="function not covered" >  ge</span>tServiceStatus() {
<span class="cstat-no" title="statement not covered" >    return {</span>
      mockMode: this.mockMode,
      providers: {
        openai: {
          enabled: this.openaiEnabled,
          configured: !!process.env.OPENAI_API_KEY
        },
        claude: {
          enabled: this.claudeEnabled,
          configured: !!process.env.ANTHROPIC_API_KEY
        }
      },
      defaultProvider: this.defaultProvider
    };
  }
&nbsp;
  // Générer des insights de santé
<span class="fstat-no" title="function not covered" >  ge</span>nerateHealthInsight(healthData) {
<span class="cstat-no" title="statement not covered" >    if (!healthData) <span class="cstat-no" title="statement not covered" >return "Connecte tes données pour des conseils personnalisés !";</span></span>
    
    const insights = <span class="cstat-no" title="statement not covered" >[];</span>
    
<span class="cstat-no" title="statement not covered" >    if (healthData.steps) {</span>
<span class="cstat-no" title="statement not covered" >      if (healthData.steps &gt;= 10000) {</span>
<span class="cstat-no" title="statement not covered" >        insights.push("Excellent pour les pas ! 🚶‍♀️");</span>
      } else <span class="cstat-no" title="statement not covered" >if (healthData.steps &gt;= 7500) {</span>
<span class="cstat-no" title="statement not covered" >        insights.push("Bon niveau d'activité !");</span>
      } else {
<span class="cstat-no" title="statement not covered" >        insights.push("On peut augmenter l'activité quotidienne");</span>
      }
    }
    
<span class="cstat-no" title="statement not covered" >    if (healthData.sleep) {</span>
<span class="cstat-no" title="statement not covered" >      if (healthData.sleep &gt;= 7) {</span>
<span class="cstat-no" title="statement not covered" >        insights.push("Sommeil dans la bonne moyenne ! 😴");</span>
      } else {
<span class="cstat-no" title="statement not covered" >        insights.push("Le sommeil pourrait être optimisé");</span>
      }
    }
    
<span class="cstat-no" title="statement not covered" >    return insights.length &gt; 0 ? insights.join(' ') : "Tes données montrent du progrès !";</span>
  }
&nbsp;
  // Générer conseil sommeil
<span class="fstat-no" title="function not covered" >  ge</span>nerateSleepAdvice(healthData) {
<span class="cstat-no" title="statement not covered" >    if (!healthData?.sleep) <span class="cstat-no" title="statement not covered" >return "Connecte tes données de sommeil pour des conseils précis !";</span></span>
    
<span class="cstat-no" title="statement not covered" >    if (healthData.sleep &lt; 6) {</span>
<span class="cstat-no" title="statement not covered" >      return "Tu manques de sommeil. Essaie de te coucher 30min plus tôt.";</span>
    } else <span class="cstat-no" title="statement not covered" >if (healthData.sleep &gt; 9) {</span>
<span class="cstat-no" title="statement not covered" >      return "Tu dors beaucoup ! Vérifie la qualité de ton sommeil.";</span>
    } else {
<span class="cstat-no" title="statement not covered" >      return "Ta durée de sommeil est correcte ! Focus sur la qualité.";</span>
    }
  }
&nbsp;
  // Générer conseil stress
<span class="fstat-no" title="function not covered" >  ge</span>nerateStressAdvice(healthData) {
<span class="cstat-no" title="statement not covered" >    if (!healthData?.stress) <span class="cstat-no" title="statement not covered" >return "Active le monitoring de stress pour des conseils adaptés !";</span></span>
    
<span class="cstat-no" title="statement not covered" >    if (healthData.stress &gt; 70) {</span>
<span class="cstat-no" title="statement not covered" >      return "Niveau de stress élevé détecté. Prends une pause !";</span>
    } else <span class="cstat-no" title="statement not covered" >if (healthData.stress &gt; 50) {</span>
<span class="cstat-no" title="statement not covered" >      return "Stress modéré. Quelques exercices de respiration seraient bénéfiques.";</span>
    } else {
<span class="cstat-no" title="statement not covered" >      return "Ton stress semble bien géré ! Continue comme ça.";</span>
    }
  }
&nbsp;
  // Générer conseil générique
<span class="fstat-no" title="function not covered" >  ge</span>nerateGenericAdvice(message, context) {
    const advices = <span class="cstat-no" title="statement not covered" >[</span>
      "une approche progressive et personnalisée",
      "de commencer par de petits changements durables",
      "d'écouter ton corps et ajuster selon tes sensations",
      "de rester régulier dans tes efforts",
      "de célébrer chaque petit progrès"
    ];
    
<span class="cstat-no" title="statement not covered" >    return advices[Math.floor(Math.random() * advices.length)];</span>
  }
&nbsp;
  // Sélectionner le provider optimal
<span class="fstat-no" title="function not covered" >  se</span>lectProvider(preferredProvider = <span class="branch-0 cbranch-no" title="branch not covered" >null)</span> {
<span class="cstat-no" title="statement not covered" >    if (preferredProvider &amp;&amp; this.isProviderAvailable(preferredProvider)) {</span>
<span class="cstat-no" title="statement not covered" >      return preferredProvider;</span>
    }
    
<span class="cstat-no" title="statement not covered" >    if (this.claudeEnabled) <span class="cstat-no" title="statement not covered" >return 'claude';</span></span>
<span class="cstat-no" title="statement not covered" >    if (this.openaiEnabled) <span class="cstat-no" title="statement not covered" >return 'openai';</span></span>
    
<span class="cstat-no" title="statement not covered" >    return 'mock';</span>
  }
&nbsp;
  // Vérifier disponibilité d'un provider
<span class="fstat-no" title="function not covered" >  is</span>ProviderAvailable(provider) {
<span class="cstat-no" title="statement not covered" >    switch (provider) {</span>
      case 'claude': <span class="cstat-no" title="statement not covered" >return this.claudeEnabled;</span>
      case 'openai': <span class="cstat-no" title="statement not covered" >return this.openaiEnabled;</span>
      default: <span class="cstat-no" title="statement not covered" >return false;</span>
    }
  }
&nbsp;
  // Calculer le coût approximatif
<span class="fstat-no" title="function not covered" >  ca</span>lculateCost(provider, inputTokens, outputTokens) {
    const costs = <span class="cstat-no" title="statement not covered" >{</span>
      openai: { input: 0.001, output: 0.002 }, // Par 1000 tokens
      claude: { input: 0.003, output: 0.015 }  // Par 1000 tokens
    };
    
    const providerCosts = <span class="cstat-no" title="statement not covered" >costs[provider];</span>
<span class="cstat-no" title="statement not covered" >    if (!providerCosts) <span class="cstat-no" title="statement not covered" >return 0;</span></span>
    
<span class="cstat-no" title="statement not covered" >    return ((inputTokens * providerCosts.input) + (outputTokens * providerCosts.output)) / 1000;</span>
  }
&nbsp;
  // Analyser les tendances de conversation
<span class="fstat-no" title="function not covered" >  as</span>ync analyzeConversationTrends(userId, days = <span class="branch-0 cbranch-no" title="branch not covered" >30)</span> {
    // TODO: Implémenter l'analyse des tendances de conversation
    // Analyser les sujets les plus discutés, l'évolution des questions, etc.
    
<span class="cstat-no" title="statement not covered" >    return {</span>
      topTopics: ['nutrition', 'fitness', 'sleep'],
      engagement: 'high',
      progressionNoted: true,
      suggestions: [
        'Continuer à poser des questions sur la nutrition',
        'Explorer les techniques de gestion du stress',
        'Planifier des objectifs fitness à long terme'
      ]
    };
  }
}
&nbsp;
module.exports = new AIChatService();</pre></td></tr></table></pre>

                <div class='push'></div><!-- for sticky footer -->
            </div><!-- /wrapper -->
            <div class='footer quiet pad2 space-top1 center small'>
                Code coverage generated by
                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
                at 2025-09-11T16:55:54.953Z
            </div>
        <script src="../../../prettify.js"></script>
        <script>
            window.onload = function () {
                prettyPrint();
            };
        </script>
        <script src="../../../sorter.js"></script>
        <script src="../../../block-navigation.js"></script>
    </body>
</html>
    